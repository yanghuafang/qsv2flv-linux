# qsv2flv

A small open-source utility that converts (actually *remuxes*) iQIYI **.qsv** files to common container formats such as **.mp4** and **.flv** with no quality loss.

Original project: https://github.com/btnkij/qsv2flv

---

## 1. Quick Notes for End-Users

1. **Prefer `.mp4`** – some videos cannot be remuxed to `.flv` because they use H.265/HEVC or contain broken frames generated by the official client. MP4 is the most widely-supported format and plays on virtually every device.
2. If the program shows an **English** error message, it is almost always a bug in the tool itself. If the message is in your own language it usually indicates a problem with the source video.
3. Bugs are possible. Feel free to open an *Issue* and, if possible, provide a download link or at least the client version + video title + resolution that fails.

---

## 2. Building on Ubuntu 20.04

### Prerequisites

```bash
sudo apt update
sudo apt install build-essential qt5-default qtbase5-dev qt5-qmake \
                 libavcodec-dev libavformat-dev libavutil-dev \
                 libavdevice-dev libavfilter-dev libpostproc-dev \
                 libswresample-dev libswscale-dev
```

### Compile

```bash
# in the project root
eqmake
make -j$(nproc)
```

The binary `qsv2flv` will be generated in the same directory.

*The `ffmpeg/` folder shipped in the repository is only used when compiling on Windows and is ignored on Linux.*

---

## 3. Directory Overview

| Path / File | Purpose |
|-------------|---------|
| `converter*` | Core logic for merging the extracted segments and writing the output container |
| `qsvreader*` | Reads `.qsv` files and exposes each segment as a byte stream |
| `datamodel`, `inputfilemodel` | In-memory data models used by the Qt GUI |
| `mainwindow*` | GUI controller generated by Qt Designer & glue code |
| `ffmpeg/` | Pre-built Windows FFmpeg headers and libs (unused on Linux) |
| `secret/` | Stand-alone demo code explaining the `.qsv` format (not part of the Qt project) |

---

## 4. Known Technical Issues / TODO

1. **Packets without timestamps** – currently solved by enabling `AVFMT_NOTIMESTAMPS`:
   ```cpp
   // converter.cpp – AVFormatContext* createOutputContext(...)
   outCtx->oformat->flags |= AVFMT_NOTIMESTAMPS;
   ```
2. **Slow seeking on large videos** – may be caused by a missing index table.

Pull requests are welcome!
